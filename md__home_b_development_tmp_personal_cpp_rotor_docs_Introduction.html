<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rotor: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="extra.css" rel="stylesheet" type="text/css" />
</head>
<body>
<a href="http://www.reactivemanifesto.org/"> <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src="//d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-white-right.png"> </a>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rotor
   </div>
   <div id="projectbrief">Event loop friendly C++ actor micro-framework</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__home_b_development_tmp_personal_cpp_rotor_docs_Introduction.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a href="https://github.com/basiliscos/cpp-rotor">rotor</a> is event loop friendly C++ actor micro framework.</p>
<p >That means, that rotor is probably useless without <b>event loop</b>, e.g. <a href="https://www.boost.org/doc/libs/release/libs/asio/" title="Boost Asio">boost-asio</a> or <a href="https://www.wxwidgets.org/" title="wxWidgets">wx-widgets</a> event loop; as a <b>framework</b> rotor imposes some usage patters of <a href="https://en.wikipedia.org/wiki/Actor_model" title="Actor Model">actor-model</a>, however their amount a bare minimum, hence it is <b>micro</b> framework.</p>
<p >As actor model and event loops are asynchronous by their nature, the underlying intuition is to uplift the low level <em>events</em> of an event loop into high level messages between actors, making high-level messages abstracted from the event loop; hence <a href="https://github.com/basiliscos/cpp-rotor">rotor</a> should provide message passing facilities between actors <em>independently</em> from the used event loop(s).</p>
<p ><a href="https://github.com/basiliscos/cpp-rotor">rotor</a> can be used in the applications, where different loop engines are used together and it is desirable to write some loop-agnostic logic still having message passing interface. The library can be used as lightweight loop abstraction with actor-like flavor.</p>
<p ><a href="https://github.com/basiliscos/cpp-rotor">rotor</a> should be considered <b>experimental</b> project, i.e. no stability in API is guaranteed.</p>
<p ><a href="https://github.com/basiliscos/cpp-rotor">rotor</a> is licensed on <em>MIT</em> license.</p>
<p ><a href="https://github.com/basiliscos/cpp-rotor">rotor</a> is influenced by <a href="https://github.com/Stiffstream/sobjectizer">sobjectizer</a>.</p>
<h1>Hello World (loop-less)</h1>
<p >This example is very artificial, and probably will never be met in the real-life, as the supervisor does not uses any event loop:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rotor_8hpp.html">rotor.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dummy_supervisor.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>hello_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">on_start</a>() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a>();</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;hello world\n&quot;</span>;</div>
<div class="line">        supervisor-&gt;do_shutdown();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_struct" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500}; <span class="comment">/* does not matter */</span></div>
<div class="line">    <span class="keyword">auto</span> sup = ctx.<a class="code hl_function" href="structrotor_1_1system__context__t.html#a4cbee07c2fce07e9138643cd8ec8222a">create_supervisor</a>&lt;dummy_supervisor_t&gt;().timeout(timeout).finish();</div>
<div class="line">    sup-&gt;create_actor&lt;hello_actor&gt;().timeout(timeout).finish();</div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="arotor_8hpp_html"><div class="ttname"><a href="rotor_8hpp.html">rotor.hpp</a></div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html"><div class="ttname"><a href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a></div><div class="ttdoc">universal primitive of concurrent computation</div><div class="ttdef"><b>Definition:</b> actor_base.h:47</div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_aa07be01bedb60e529da93ee446cd8f2c"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a></div><div class="ttdeci">actor_base_t(config_t &amp;cfg)</div><div class="ttdoc">constructs actor and links it's supervisor</div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_abd09068676677472caabe32ed7ef7aaf"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a></div><div class="ttdeci">virtual void on_start() noexcept</div><div class="ttdoc">actor is fully initialized and it's supervisor has sent signal to start</div></div>
<div class="ttc" id="astructrotor_1_1system__context__t_html"><div class="ttname"><a href="structrotor_1_1system__context__t.html">rotor::system_context_t</a></div><div class="ttdoc">The system context holds root supervisor_t (intrusive pointer) and may be loop-related details in der...</div><div class="ttdef"><b>Definition:</b> system_context.h:30</div></div>
<div class="ttc" id="astructrotor_1_1system__context__t_html_a4cbee07c2fce07e9138643cd8ec8222a"><div class="ttname"><a href="structrotor_1_1system__context__t.html#a4cbee07c2fce07e9138643cd8ec8222a">rotor::system_context_t::create_supervisor</a></div><div class="ttdeci">auto create_supervisor()</div><div class="ttdoc">returns builder for root supervisor</div><div class="ttdef"><b>Definition:</b> supervisor.h:353</div></div>
</div><!-- fragment --><p >It prints "hello world" and exits. The example uses <code>dummy_supervisor_t</code> (sources ommited), which does almost nothing, but gives you idea what supervisor should do. The code with "real" supervisor is shown below, however for pure messaging the kind of supervisor does not matter.</p>
<h1>Hello World (boost::asio loop)</h1>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>asio = boost::asio;</div>
<div class="line"><span class="keyword">namespace </span>pt = boost::posix_time;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>server_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">on_start</a>() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a>();</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;hello world\n&quot;</span>;</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a67322e4c89d4312ebb762d451b424d79">do_shutdown</a>();</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    asio::io_context io_context;</div>
<div class="line">    <span class="keyword">auto</span> system_context = <a class="code hl_typedef" href="structrotor_1_1asio_1_1system__context__asio__t.html#afeafb09bee3302d4f691bab45a4499cb">rotor::asio::system_context_asio_t::ptr_t</a>{<span class="keyword">new</span> <a class="code hl_struct" href="structrotor_1_1asio_1_1system__context__asio__t.html">rotor::asio::system_context_asio_t</a>(io_context)};</div>
<div class="line">    <span class="keyword">auto</span> strand = std::make_shared&lt;asio::io_context::strand&gt;(io_context);</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500};</div>
<div class="line">    <span class="keyword">auto</span> sup = system_context-&gt;create_supervisor&lt;<a class="code hl_struct" href="structrotor_1_1asio_1_1supervisor__asio__t.html">rotor::asio::supervisor_asio_t</a>&gt;()</div>
<div class="line">        .strand(strand)</div>
<div class="line">        .timeout(timeout)</div>
<div class="line">        .finish();</div>
<div class="line"> </div>
<div class="line">    sup-&gt;<a class="code hl_function" href="structrotor_1_1supervisor__t.html#a9d4f8b1c6d2abdfd402e3715002c6343">create_actor</a>&lt;server_actor&gt;()</div>
<div class="line">        .timeout(timeout)</div>
<div class="line">        .autoshutdown_supervisor()</div>
<div class="line">        .finish();</div>
<div class="line"> </div>
<div class="line">    sup-&gt;start();</div>
<div class="line">    io_context.run();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_a67322e4c89d4312ebb762d451b424d79"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#a67322e4c89d4312ebb762d451b424d79">rotor::actor_base_t::do_shutdown</a></div><div class="ttdeci">virtual void do_shutdown(const extended_error_ptr_t &amp;reason={}) noexcept</div><div class="ttdoc">convenient method to send actor's supervisor shutdown trigger message</div></div>
<div class="ttc" id="astructrotor_1_1asio_1_1supervisor__asio__t_html"><div class="ttname"><a href="structrotor_1_1asio_1_1supervisor__asio__t.html">rotor::asio::supervisor_asio_t</a></div><div class="ttdoc">delivers rotor-messages on top of boost asio event loop using strand for serialization</div><div class="ttdef"><b>Definition:</b> supervisor_asio.h:56</div></div>
<div class="ttc" id="astructrotor_1_1asio_1_1system__context__asio__t_html"><div class="ttname"><a href="structrotor_1_1asio_1_1system__context__asio__t.html">rotor::asio::system_context_asio_t</a></div><div class="ttdoc">The boost::asio system context, which holds a reference to boost::asio::io_context and root superviso...</div><div class="ttdef"><b>Definition:</b> system_context_asio.h:32</div></div>
<div class="ttc" id="astructrotor_1_1asio_1_1system__context__asio__t_html_afeafb09bee3302d4f691bab45a4499cb"><div class="ttname"><a href="structrotor_1_1asio_1_1system__context__asio__t.html#afeafb09bee3302d4f691bab45a4499cb">rotor::asio::system_context_asio_t::ptr_t</a></div><div class="ttdeci">rotor::intrusive_ptr_t&lt; system_context_asio_t &gt; ptr_t</div><div class="ttdoc">intrusive pointer type for boost::asio system context</div><div class="ttdef"><b>Definition:</b> system_context_asio.h:34</div></div>
<div class="ttc" id="astructrotor_1_1supervisor__t_html_a9d4f8b1c6d2abdfd402e3715002c6343"><div class="ttname"><a href="structrotor_1_1supervisor__t.html#a9d4f8b1c6d2abdfd402e3715002c6343">rotor::supervisor_t::create_actor</a></div><div class="ttdeci">auto create_actor()</div><div class="ttdoc">creates child-actor builder</div><div class="ttdef"><b>Definition:</b> supervisor.h:198</div></div>
</div><!-- fragment --><p >It is obvious that the actor code is the almost the same in both cases, however the system environment and supervisors are different. In the last example the important property of <a href="https://github.com/basiliscos/cpp-rotor">rotor</a> is shown : it is <b>not intrusive</b> to event loops, i.e. an event loop runs on by itself, not introducing additional environment/thread; as the consequence, rotor actor can be seamlessly integrated with loops.</p>
<p >The <code>supervisor.do_shutdown()</code> from previous example just sends message to supervisor to perform shutdown procedure. However, it might be better to have <code>.autoshutdown_supervisor()</code> during actor setup, as it will shutdown supervisor in any case (i.e. not only from <code>on_start()</code>). Then, in the code <code>io_context.run()</code> loop terminates, as long as <em>there are no any pending event</em>. <a href="https://github.com/basiliscos/cpp-rotor">rotor</a> does not make loop run endlessly.</p>
<p >The <code>timeout</code> variable is used to spawn timers for actor initialization and shutdown requests. As the actor does not do any I/O the operations will be executed immediately, and timeout values do not matter.</p>
<h1>Ping-pong example</h1>
<p >The following example demonstrates how to send messages between actors.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ping_t {};</div>
<div class="line"><span class="keyword">struct </span>pong_t {};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>pinger_t : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_ponger_addr(<span class="keyword">const</span> <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> &amp;addr) { ponger_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;([](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;pinger_t::on_pong); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">on_start</a>() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a>();</div>
<div class="line">        send&lt;ping_t&gt;(ponger_addr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_pong(<a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::message_t&lt;pong_t&gt;</a> &amp;) <span class="keyword">noexcept</span> {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;pong\n&quot;</span>;</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a67322e4c89d4312ebb762d451b424d79">do_shutdown</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> ponger_addr;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ponger_t : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line">    <span class="keywordtype">void</span> set_pinger_addr(<span class="keyword">const</span> <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> &amp;addr) { pinger_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;([](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;ponger_t::on_ping); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_ping(<a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::message_t&lt;ping_t&gt;</a> &amp;) <span class="keyword">noexcept</span> {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;ping\n&quot;</span>;</div>
<div class="line">        send&lt;pong_t&gt;(pinger_addr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> pinger_addr;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_struct" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500}; <span class="comment">/* does not matter */</span></div>
<div class="line">    <span class="keyword">auto</span> sup = ctx.<a class="code hl_function" href="structrotor_1_1system__context__t.html#a4cbee07c2fce07e9138643cd8ec8222a">create_supervisor</a>&lt;dummy_supervisor_t&gt;().timeout(timeout).finish();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> pinger = sup-&gt;create_actor&lt;pinger_t&gt;()</div>
<div class="line">                      .init_timeout(timeout)</div>
<div class="line">                      .shutdown_timeout(timeout)</div>
<div class="line">                      .autoshutdown_supervisor()</div>
<div class="line">                      .finish();</div>
<div class="line">    <span class="keyword">auto</span> ponger = sup-&gt;create_actor&lt;ponger_t&gt;()</div>
<div class="line">                      .timeout(timeout) <span class="comment">// shortcut for init/shutdown</span></div>
<div class="line">                      .finish();</div>
<div class="line">    pinger-&gt;set_ponger_addr(ponger-&gt;get_address());</div>
<div class="line">    ponger-&gt;set_pinger_addr(pinger-&gt;get_address());</div>
<div class="line"> </div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespacerotor_html_a25565725c774761a67bd766d93617326"><div class="ttname"><a href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a></div><div class="ttdeci">intrusive_ptr_t&lt; address_t &gt; address_ptr_t</div><div class="ttdoc">intrusive pointer for address</div><div class="ttdef"><b>Definition:</b> address.hpp:57</div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_a1c7143d733572600a355d8bcb02367bc"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a></div><div class="ttdeci">virtual void configure(plugin::plugin_base_t &amp;plugin) noexcept</div><div class="ttdoc">main callback for plugin configuration when it's ready</div></div>
<div class="ttc" id="astructrotor_1_1message__t_html"><div class="ttname"><a href="structrotor_1_1message__t.html">rotor::message_t</a></div><div class="ttdoc">the generic message meant to hold user-specific payload</div><div class="ttdef"><b>Definition:</b> message.h:58</div></div>
<div class="ttc" id="astructrotor_1_1plugin_1_1plugin__base__t_html"><div class="ttname"><a href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a></div><div class="ttdoc">base class for all actor plugins</div><div class="ttdef"><b>Definition:</b> plugin_base.h:21</div></div>
<div class="ttc" id="astructrotor_1_1plugin_1_1starter__plugin__t_html"><div class="ttname"><a href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a></div><div class="ttdoc">allows custom (actor) subscriptions and it is responsibe for starting actor when it receives message:...</div><div class="ttdef"><b>Definition:</b> starter.h:19</div></div>
</div><!-- fragment --><p >Without loss of generality the system context/supervisor can be switched to any other and the example will still work, because the actors in the sample are <b>loop-agnostic</b>, as well as the messages.</p>
<p >In the real world scenarios, actors might be not so pure, i.e. they will interact with timers and other system events, however the interface for sending messages is still the same (i.e. loop-agnostic), which makes it quite a convenient way to send messages to actors running on <em>different loops</em>.</p>
<h1>pub-sub example</h1>
<p >Any message can be send to any address; any actor, including actors running on different supervisors and loops, can subscribe to any kind of message on any address.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rotor_8hpp.html">rotor.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dummy_supervisor.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>r = <a class="code hl_namespace" href="namespacerotor.html">rotor</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>payload_t {};</div>
<div class="line"><span class="keyword">using </span>sample_message_t = r::message_t&lt;payload_t&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>pub_t : <span class="keyword">public</span> r::actor_base_t {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using </span>r::actor_base_t::actor_base_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_pub_addr(<span class="keyword">const</span> r::address_ptr_t &amp;addr) { pub_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_start() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        r::actor_base_t::on_start();</div>
<div class="line">        send&lt;payload_t&gt;(pub_addr);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    r::address_ptr_t pub_addr;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>sub_t : <span class="keyword">public</span> r::actor_base_t {</div>
<div class="line">    <span class="keyword">using </span>r::actor_base_t::actor_base_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_pub_addr(<span class="keyword">const</span> r::address_ptr_t &amp;addr) { pub_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> configure(r::plugin::plugin_base_t &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;r::plugin::starter_plugin_t&gt;(</div>
<div class="line">            [&amp;](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;sub_t::on_payload, pub_addr); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_payload(sample_message_t &amp;) <span class="keyword">noexcept</span> { std::cout &lt;&lt; <span class="stringliteral">&quot;received on &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; }</div>
<div class="line"> </div>
<div class="line">    r::address_ptr_t pub_addr;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_struct" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500}; <span class="comment">/* does not matter */</span></div>
<div class="line">    <span class="keyword">auto</span> sup = ctx.<a class="code hl_function" href="structrotor_1_1system__context__t.html#a4cbee07c2fce07e9138643cd8ec8222a">create_supervisor</a>&lt;dummy_supervisor_t&gt;().timeout(timeout).finish();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> pub_addr = sup-&gt;create_address(); <span class="comment">// (1)</span></div>
<div class="line">    <span class="keyword">auto</span> pub = sup-&gt;create_actor&lt;pub_t&gt;().timeout(timeout).finish();</div>
<div class="line">    <span class="keyword">auto</span> sub1 = sup-&gt;create_actor&lt;sub_t&gt;().timeout(timeout).finish();</div>
<div class="line">    <span class="keyword">auto</span> sub2 = sup-&gt;create_actor&lt;sub_t&gt;().timeout(timeout).finish();</div>
<div class="line"> </div>
<div class="line">    pub-&gt;set_pub_addr(pub_addr);</div>
<div class="line">    sub1-&gt;set_pub_addr(pub_addr);</div>
<div class="line">    sub2-&gt;set_pub_addr(pub_addr);</div>
<div class="line"> </div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line"> </div>
<div class="line">    sup-&gt;do_shutdown();</div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespacerotor_html"><div class="ttname"><a href="namespacerotor.html">rotor</a></div><div class="ttdoc">Basic namespace for all rotor functionalities.</div><div class="ttdef"><b>Definition:</b> rotor.hpp:21</div></div>
</div><!-- fragment --><p >Output sample: </p><div class="fragment"><div class="line">received on 0x55d159ea36c0</div>
<div class="line">received on 0x55d159ea3dc0</div>
</div><!-- fragment --><p >The address in the line <code>(1)</code> is arbitrary: the address of pub-actor itself as well as the address of the supervisor can be used... even address of different supervisor can be used.</p>
<p >Please note, that sinse <code>v0.09</code> there is a new way of subscribing an actor to messages: now it is done via <code>starter_plugin_t</code> and overriding <code>configure</code> method of the actor.</p>
<h1>request-response example (boost::asio)</h1>
<p >In the example below the usage of request-response pattern is demonstrated. The "server" actor takes the number from request and replies to "client" actor with square root if the value is &gt;= 0, otherwise it replies with error.</p>
<p >Contrary to the regular messages, request-response is a little bit more complex pattern: the response should include full request (message) to be able to match to the request, as well as the possibility of response not arrival in time; in the last case the response message should arrive with error.</p>
<p >That's why below not pure user-defined payloads are used, but a little bit modified to support request/reply machinery.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rotor_8hpp.html">rotor.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="asio_8hpp.html">rotor/asio.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;system_error&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>asio = boost::asio;</div>
<div class="line"><span class="keyword">namespace </span>pt = boost::posix_time;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>payload {</div>
<div class="line"><span class="keyword">struct </span>sample_res_t {</div>
<div class="line">    <span class="keywordtype">double</span> value;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>sample_req_t {</div>
<div class="line">    <span class="keyword">using </span>response_t = sample_res_t;</div>
<div class="line">    <span class="keywordtype">double</span> value;</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace payload</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>message {</div>
<div class="line"><span class="keyword">using </span>request_t = <a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::request_traits_t&lt;payload::sample_req_t&gt;::request::message_t</a>;</div>
<div class="line"><span class="keyword">using </span>response_t = <a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::request_traits_t&lt;payload::sample_req_t&gt;::response::message_t</a>;</div>
<div class="line">} <span class="comment">// namespace message</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>server_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;(</div>
<div class="line">            [](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;server_actor::on_request); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_request(message::request_t &amp;req) <span class="keyword">noexcept</span> {</div>
<div class="line">        <span class="keyword">auto</span> in = req.payload.request_payload.value;</div>
<div class="line">        <span class="keywordflow">if</span> (in &gt;= 0) {</div>
<div class="line">            <span class="keyword">auto</span> value = std::sqrt(in);</div>
<div class="line">            <a class="code hl_function" href="structrotor_1_1actor__base__t.html#aec6c48a92d2df207e8c4739d26e3c38b">reply_to</a>(req, value);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// IRL, it should be your custom error codes</span></div>
<div class="line">            <span class="keyword">auto</span> ec = std::make_error_code(std::errc::invalid_argument);</div>
<div class="line">            <a class="code hl_function" href="structrotor_1_1actor__base__t.html#acba9a9c233048b4772763a30d30c8453">reply_with_error</a>(req, <a class="code hl_function" href="structrotor_1_1actor__base__t.html#acfca9ad68e25017920b42593efdd16ce">make_error</a>(ec));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>client_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> server_addr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_server(<span class="keyword">const</span> <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> addr) { server_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;(</div>
<div class="line">            [](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;client_actor::on_response); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_response(message::response_t &amp;res) <span class="keyword">noexcept</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (!res.payload.ee) { <span class="comment">// check for possible error</span></div>
<div class="line">            <span class="keyword">auto</span> &amp;in = res.payload.req-&gt;payload.request_payload.value;</div>
<div class="line">            <span class="keyword">auto</span> &amp;out = res.payload.res.value;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; in = &quot;</span> &lt;&lt; in &lt;&lt; <span class="stringliteral">&quot;, out = &quot;</span> &lt;&lt; out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a67322e4c89d4312ebb762d451b424d79">do_shutdown</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">on_start</a>() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a>();</div>
<div class="line">        <span class="keyword">auto</span> timeout = rotor::pt::milliseconds{1};</div>
<div class="line">        request&lt;payload::sample_req_t&gt;(server_addr, 25.0).send(timeout);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    asio::io_context io_context;</div>
<div class="line">    <span class="keyword">auto</span> system_context = <a class="code hl_typedef" href="structrotor_1_1asio_1_1system__context__asio__t.html#afeafb09bee3302d4f691bab45a4499cb">rotor::asio::system_context_asio_t::ptr_t</a>{<span class="keyword">new</span> <a class="code hl_struct" href="structrotor_1_1asio_1_1system__context__asio__t.html">rotor::asio::system_context_asio_t</a>(io_context)};</div>
<div class="line">    <span class="keyword">auto</span> strand = std::make_shared&lt;asio::io_context::strand&gt;(io_context);</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500};</div>
<div class="line">    <span class="keyword">auto</span> sup =</div>
<div class="line">        system_context-&gt;create_supervisor&lt;<a class="code hl_struct" href="structrotor_1_1asio_1_1supervisor__asio__t.html">rotor::asio::supervisor_asio_t</a>&gt;().strand(strand).timeout(timeout).finish();</div>
<div class="line">    <span class="keyword">auto</span> server = sup-&gt;<a class="code hl_function" href="structrotor_1_1supervisor__t.html#a9d4f8b1c6d2abdfd402e3715002c6343">create_actor</a>&lt;server_actor&gt;().timeout(timeout).finish();</div>
<div class="line">    <span class="keyword">auto</span> client = sup-&gt;create_actor&lt;client_actor&gt;().timeout(timeout).autoshutdown_supervisor().finish();</div>
<div class="line">    client-&gt;set_server(server-&gt;get_address());</div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aasio_8hpp_html"><div class="ttname"><a href="asio_8hpp.html">asio.hpp</a></div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_acba9a9c233048b4772763a30d30c8453"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#acba9a9c233048b4772763a30d30c8453">rotor::actor_base_t::reply_with_error</a></div><div class="ttdeci">void reply_with_error(Request &amp;message, const extended_error_ptr_t &amp;ec)</div><div class="ttdoc">convenient method for constructing and sending error response to a request</div><div class="ttdef"><b>Definition:</b> supervisor.h:597</div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_acfca9ad68e25017920b42593efdd16ce"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#acfca9ad68e25017920b42593efdd16ce">rotor::actor_base_t::make_error</a></div><div class="ttdeci">extended_error_ptr_t make_error(const std::error_code &amp;ec, const extended_error_ptr_t &amp;next={}) noexcept</div><div class="ttdoc">makes extended error within the context of the actor</div></div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_aec6c48a92d2df207e8c4739d26e3c38b"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#aec6c48a92d2df207e8c4739d26e3c38b">rotor::actor_base_t::reply_to</a></div><div class="ttdeci">void reply_to(Request &amp;message, Args &amp;&amp;...args)</div><div class="ttdoc">convenient method for constructing and sending response to a request</div><div class="ttdef"><b>Definition:</b> supervisor.h:593</div></div>
</div><!-- fragment --><p >Output sample: </p><div class="fragment"><div class="line">in = 25, out = 5</div>
</div><!-- fragment --><h1>registry example (boost::asio)</h1>
<p >There is a minor drawback in the last example: the binding of client and server actors is performed manually, the server address is injected directly into client actor and there is no any guarantees that server actor will "outlive" client actor.</p>
<p >As usual in the computer sciences all problems can be solved with additional layer of indirection. We'll create special registry actor. When server actor will be ready, it will register self there under symbolic name "server"; the client actor will look up in the registry server address by the same symbolic name and "link" to the server actor, i.e. make sure that server actor will have longer lifetime than client actor.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rotor_8hpp.html">rotor.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="asio_8hpp.html">rotor/asio.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;system_error&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>asio = boost::asio;</div>
<div class="line"><span class="keyword">namespace </span>pt = boost::posix_time;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>payload {</div>
<div class="line"><span class="keyword">struct </span>sample_res_t {</div>
<div class="line">    <span class="keywordtype">double</span> value;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>sample_req_t {</div>
<div class="line">    <span class="keyword">using </span>response_t = sample_res_t;</div>
<div class="line">    <span class="keywordtype">double</span> value;</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace payload</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>message {</div>
<div class="line"><span class="keyword">using </span>request_t = <a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::request_traits_t&lt;payload::sample_req_t&gt;::request::message_t</a>;</div>
<div class="line"><span class="keyword">using </span>response_t = <a class="code hl_struct" href="structrotor_1_1message__t.html">rotor::request_traits_t&lt;payload::sample_req_t&gt;::response::message_t</a>;</div>
<div class="line">} <span class="comment">// namespace message</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>server_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;(</div>
<div class="line">            [](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;server_actor::on_request); });</div>
<div class="line">        plugin.<a class="code hl_function" href="structrotor_1_1plugin_1_1plugin__base__t.html#acf872f647caddf6a865e22f629964532">with_casted</a>&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1registry__plugin__t.html">rotor::plugin::registry_plugin_t</a>&gt;(</div>
<div class="line">            [&amp;](<span class="keyword">auto</span> &amp;p) { p.register_name(<span class="stringliteral">&quot;server&quot;</span>, <a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa368bdd31ff6975f3e678de2d9040945">get_address</a>()); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_request(message::request_t &amp;req) <span class="keyword">noexcept</span> {</div>
<div class="line">        <span class="keyword">auto</span> in = req.payload.request_payload.value;</div>
<div class="line">        <span class="keywordflow">if</span> (in &gt;= 0) {</div>
<div class="line">            <span class="keyword">auto</span> value = std::sqrt(in);</div>
<div class="line">            <a class="code hl_function" href="structrotor_1_1actor__base__t.html#aec6c48a92d2df207e8c4739d26e3c38b">reply_to</a>(req, value);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// IRL, it should be your custom error codes</span></div>
<div class="line">            <span class="keyword">auto</span> ec = std::make_error_code(std::errc::invalid_argument);</div>
<div class="line">            <a class="code hl_function" href="structrotor_1_1actor__base__t.html#acba9a9c233048b4772763a30d30c8453">reply_with_error</a>(req, <a class="code hl_function" href="structrotor_1_1actor__base__t.html#acfca9ad68e25017920b42593efdd16ce">make_error</a>(ec));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>client_actor : <span class="keyword">public</span> <a class="code hl_struct" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="structrotor_1_1actor__base__t.html#aa07be01bedb60e529da93ee446cd8f2c">rotor::actor_base_t::actor_base_t</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> server_addr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_server(<span class="keyword">const</span> <a class="code hl_typedef" href="namespacerotor.html#a25565725c774761a67bd766d93617326">rotor::address_ptr_t</a> addr) { server_addr = addr; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">configure</a>(<a class="code hl_struct" href="structrotor_1_1plugin_1_1plugin__base__t.html">rotor::plugin::plugin_base_t</a> &amp;plugin) <span class="keyword">noexcept</span> <span class="keyword">override</span> {</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a1c7143d733572600a355d8bcb02367bc">rotor::actor_base_t::configure</a>(plugin);</div>
<div class="line">        plugin.with_casted&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1starter__plugin__t.html">rotor::plugin::starter_plugin_t</a>&gt;(</div>
<div class="line">            [](<span class="keyword">auto</span> &amp;p) { p.subscribe_actor(&amp;client_actor::on_response); });</div>
<div class="line">        plugin.<a class="code hl_function" href="structrotor_1_1plugin_1_1plugin__base__t.html#acf872f647caddf6a865e22f629964532">with_casted</a>&lt;<a class="code hl_struct" href="structrotor_1_1plugin_1_1registry__plugin__t.html">rotor::plugin::registry_plugin_t</a>&gt;(</div>
<div class="line">            [&amp;](<span class="keyword">auto</span> &amp;p) { p.discover_name(<span class="stringliteral">&quot;server&quot;</span>, server_addr, <span class="keyword">true</span>).link(); });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> on_response(message::response_t &amp;res) <span class="keyword">noexcept</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (!res.payload.ee) { <span class="comment">// check for possible error</span></div>
<div class="line">            <span class="keyword">auto</span> &amp;in = res.payload.req-&gt;payload.request_payload.value;</div>
<div class="line">            <span class="keyword">auto</span> &amp;out = res.payload.res.value;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; in = &quot;</span> &lt;&lt; in &lt;&lt; <span class="stringliteral">&quot;, out = &quot;</span> &lt;&lt; out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#a67322e4c89d4312ebb762d451b424d79">do_shutdown</a>(); <span class="comment">// optional;</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">on_start</a>() noexcept<span class="keyword"> override </span>{</div>
<div class="line">        <a class="code hl_function" href="structrotor_1_1actor__base__t.html#abd09068676677472caabe32ed7ef7aaf">rotor::actor_base_t::on_start</a>();</div>
<div class="line">        <span class="keyword">auto</span> timeout = rotor::pt::milliseconds{1};</div>
<div class="line">        request&lt;payload::sample_req_t&gt;(server_addr, 25.0).send(timeout);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    asio::io_context io_context;</div>
<div class="line">    <span class="keyword">auto</span> system_context = <a class="code hl_typedef" href="structrotor_1_1asio_1_1system__context__asio__t.html#afeafb09bee3302d4f691bab45a4499cb">rotor::asio::system_context_asio_t::ptr_t</a>{<span class="keyword">new</span> <a class="code hl_struct" href="structrotor_1_1asio_1_1system__context__asio__t.html">rotor::asio::system_context_asio_t</a>(io_context)};</div>
<div class="line">    <span class="keyword">auto</span> strand = std::make_shared&lt;asio::io_context::strand&gt;(io_context);</div>
<div class="line">    <span class="keyword">auto</span> timeout = boost::posix_time::milliseconds{500};</div>
<div class="line">    <span class="keyword">auto</span> sup = system_context-&gt;create_supervisor&lt;<a class="code hl_struct" href="structrotor_1_1asio_1_1supervisor__asio__t.html">rotor::asio::supervisor_asio_t</a>&gt;()</div>
<div class="line">                   .strand(strand)</div>
<div class="line">                   .create_registry()</div>
<div class="line">                   .timeout(timeout)</div>
<div class="line">                   .finish();</div>
<div class="line">    <span class="keyword">auto</span> server = sup-&gt;<a class="code hl_function" href="structrotor_1_1supervisor__t.html#a9d4f8b1c6d2abdfd402e3715002c6343">create_actor</a>&lt;server_actor&gt;().timeout(timeout).finish();</div>
<div class="line">    <span class="keyword">auto</span> client = sup-&gt;create_actor&lt;client_actor&gt;().timeout(timeout).autoshutdown_supervisor().finish();</div>
<div class="line">    sup-&gt;do_process();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="astructrotor_1_1actor__base__t_html_aa368bdd31ff6975f3e678de2d9040945"><div class="ttname"><a href="structrotor_1_1actor__base__t.html#aa368bdd31ff6975f3e678de2d9040945">rotor::actor_base_t::get_address</a></div><div class="ttdeci">const address_ptr_t &amp; get_address() const noexcept</div><div class="ttdoc">returns actor's main address</div><div class="ttdef"><b>Definition:</b> actor_base.h:296</div></div>
<div class="ttc" id="astructrotor_1_1plugin_1_1plugin__base__t_html_acf872f647caddf6a865e22f629964532"><div class="ttname"><a href="structrotor_1_1plugin_1_1plugin__base__t.html#acf872f647caddf6a865e22f629964532">rotor::plugin::plugin_base_t::with_casted</a></div><div class="ttdeci">void with_casted(Fn &amp;&amp;fn, config_phase_t desired_phase=config_phase_t::INITIALIZING) noexcept</div><div class="ttdoc">invokes the callback if plugin type and phase mach</div><div class="ttdef"><b>Definition:</b> plugin_base.h:137</div></div>
<div class="ttc" id="astructrotor_1_1plugin_1_1registry__plugin__t_html"><div class="ttname"><a href="structrotor_1_1plugin_1_1registry__plugin__t.html">rotor::plugin::registry_plugin_t</a></div><div class="ttdoc">handy access to registry_t, for name registration and discovery</div><div class="ttdef"><b>Definition:</b> registry.h:35</div></div>
</div><!-- fragment --><h1>there is more...</h1>
<p >There is more rotor capabilities, like requests cancellations, and generalized timer spawning interface. Read on in the <a class="el" href="md__home_b_development_tmp_personal_cpp_rotor_docs_Examples.html">Advanced Examples</a> section. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
