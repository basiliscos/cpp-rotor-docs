<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rotor: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rotor
   </div>
   <div id="projectbrief">Event loop friendly C++ actor micro-framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_b_development_cpp_cpp-rotor_docs_Introduction.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>rotor</code> is event loop friendly C++ actor micro framework.</p>
<p>That means, that rotor is probably useless without <b>event loop</b>, e.g. <a href="https://www.boost.org/doc/libs/release/libs/asio/" title="Boost Asio">boost-asio</a> or <a href="https://www.wxwidgets.org/" title="wxWidgets">wx-widgets</a> event loop; as a <b>framework</b> rotor imposes some usage patters of <a href="https://en.wikipedia.org/wiki/Actor_model" title="Actor Model">actor-model</a>, however their amount a bare minimum, hence it is <b>micro</b> framework.</p>
<p>As actor model and event loops are asynchronous by their nature, the underlying intuion is to uplift the low level <em>events</em> of an event loop into hight-level messages between actors, making high-level messages abstrated from the event loop; hence <code>rotor</code> should provide message passing facilities between actors <em>independenly</em> from the used event loop(s).</p>
<p><code>rotor</code> can be used in the applications, where different loop engines are used together and it is desirable to write some loop-agnostic logic still having message passing interface. The library can be used as lightweight loop abstraction with actor-like flavor.</p>
<p><code>rotor</code> should be considered <b>experimental</b> project, i.e. no stability in API is guaranteed.</p>
<p><code>rotor</code> is licensed on <em>MIT</em> license.</p>
<p><code>rotor</code> is influenced by <a href="https://github.com/Stiffstream/sobjectizer">sobjectizer</a>.</p>
<h2>Hello World (loop-less)</h2>
<p>This example is very artificial, and probably will never be met in the real-life, as the supervisor does not uses any event loop:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rotor.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>hello_actor: <span class="keyword">public</span> <a class="code" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div><div class="line">    <span class="keyword">using</span> rotor::actor_base_t::actor_base_t;</div><div class="line">    <span class="keywordtype">void</span> on_start(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;rotor::payload::start_actor_t&gt;</a> &amp;) noexcept <span class="keyword">override</span> {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;hello world\n&quot;</span>;</div><div class="line">        supervisor.do_shutdown();   <span class="comment">// optional</span></div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>dummy_supervisor: <span class="keyword">public</span> <a class="code" href="structrotor_1_1supervisor__t.html">rotor::supervisor_t</a> {</div><div class="line">    <span class="keywordtype">void</span> start_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> cancel_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> start() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> shutdown() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> enqueue(rotor::message_ptr_t) noexcept <span class="keyword">override</span> {}</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    <a class="code" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div><div class="line">    <span class="keyword">auto</span> sup = ctx.create_supervisor&lt;dummy_supervisor&gt;();</div><div class="line">    sup-&gt;create_actor&lt;hello_actor&gt;();</div><div class="line">    sup-&gt;do_process();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Hello World (boost::asio loop)</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rotor/asio.hpp&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>asio = boost::asio;</div><div class="line"><span class="keyword">namespace </span>pt = boost::posix_time;</div><div class="line"></div><div class="line"><span class="keyword">struct </span>hello_actor : <span class="keyword">public</span> <a class="code" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div><div class="line">    <span class="keyword">using</span> rotor::actor_base_t::actor_base_t;</div><div class="line">    <span class="keywordtype">void</span> on_start(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;rotor::payload::start_actor_t&gt;</a> &amp;) noexcept <span class="keyword">override</span> {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;hello world\n&quot;</span>;</div><div class="line">        supervisor.do_shutdown();   <span class="comment">// optional</span></div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    asio::io_context io_context;</div><div class="line">    <span class="keyword">auto</span> system_context = rotor::asio::system_context_asio_t::ptr_t{<span class="keyword">new</span> <a class="code" href="structrotor_1_1asio_1_1system__context__asio__t.html">rotor::asio::system_context_asio_t</a>(io_context)};</div><div class="line">    <a class="code" href="structrotor_1_1asio_1_1supervisor__config__t.html">rotor::asio::supervisor_config_t</a> conf{pt::milliseconds{500}};</div><div class="line">    <span class="keyword">auto</span> sup = system_context-&gt;create_supervisor&lt;<a class="code" href="structrotor_1_1asio_1_1supervisor__asio__t.html">rotor::asio::supervisor_asio_t</a>&gt;(conf);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> hello = sup-&gt;create_actor&lt;hello_actor&gt;();</div><div class="line"></div><div class="line">    sup-&gt;start();</div><div class="line">    io_context.run();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>It is obvious that the actor code is the same in both cases, however the system environment and supervisors are different. In the last example the important property of <code>rotor</code> is shown : it is <b>not intrusive</b> to event loops, i.e. an event loop runs on by itself, not introducing additional environment/thread; as the consequence, rotor actor can be seamlessly integrated with loops.</p>
<p>The <code>supervisor.do_shutdown()</code> just sends message to supervisor to perform shutdown procedure. Then, in the code <code>io_context.run()</code> loop terminates, as long as <em>there are no any pending event</em>. <code>rotor</code> does not makes run loop endlessly.</p>
<h2>Ping-pong example</h2>
<p>The following example demonstrates how to send messages between actors.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rotor.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>ping_t {};</div><div class="line"><span class="keyword">struct </span>pong_t {};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>pinger_t : <span class="keyword">public</span> <a class="code" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div><div class="line">    <span class="keyword">using</span> rotor::actor_base_t::actor_base_t;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_ponger_addr(<span class="keyword">const</span> rotor::address_ptr_t &amp;addr) { ponger_addr = addr; }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_initialize(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;rotor::payload::initialize_actor_t&gt;</a> &amp;msg) noexcept <span class="keyword">override</span> {</div><div class="line">        rotor::actor_base_t::on_initialize(msg);</div><div class="line">        subscribe(&amp;pinger_t::on_pong);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_start(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;rotor::payload::start_actor_t&gt;</a> &amp;msg) noexcept <span class="keyword">override</span> {</div><div class="line">        rotor::actor_base_t::on_start(msg);</div><div class="line">        send&lt;ping_t&gt;(ponger_addr);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_pong(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;pong_t&gt;</a> &amp;) noexcept {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;pong\n&quot;</span>;</div><div class="line">        supervisor.do_shutdown(); <span class="comment">// optional</span></div><div class="line">    }</div><div class="line"></div><div class="line">    rotor::address_ptr_t ponger_addr;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>ponger_t : <span class="keyword">public</span> <a class="code" href="structrotor_1_1actor__base__t.html">rotor::actor_base_t</a> {</div><div class="line">    <span class="keyword">using</span> rotor::actor_base_t::actor_base_t;</div><div class="line">    <span class="keywordtype">void</span> set_pinger_addr(<span class="keyword">const</span> rotor::address_ptr_t &amp;addr) { pinger_addr = addr; }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_initialize(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;rotor::payload::initialize_actor_t&gt;</a> &amp;msg) noexcept <span class="keyword">override</span> {</div><div class="line">        rotor::actor_base_t::on_initialize(msg);</div><div class="line">        subscribe(&amp;ponger_t::on_ping);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_ping(<a class="code" href="structrotor_1_1message__t.html">rotor::message_t&lt;ping_t&gt;</a> &amp;) noexcept {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;ping\n&quot;</span>;</div><div class="line">        send&lt;pong_t&gt;(pinger_addr);</div><div class="line">    }</div><div class="line"></div><div class="line">  <span class="keyword">private</span>:</div><div class="line">    rotor::address_ptr_t pinger_addr;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>dummy_supervisor : <span class="keyword">public</span> <a class="code" href="structrotor_1_1supervisor__t.html">rotor::supervisor_t</a> {</div><div class="line">    <span class="keywordtype">void</span> start_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> cancel_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> start() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> shutdown() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> enqueue(rotor::message_ptr_t) noexcept <span class="keyword">override</span> {}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    <a class="code" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div><div class="line">    <span class="keyword">auto</span> sup = ctx.create_supervisor&lt;dummy_supervisor&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> pinger = sup-&gt;create_actor&lt;pinger_t&gt;();</div><div class="line">    <span class="keyword">auto</span> ponger = sup-&gt;create_actor&lt;ponger_t&gt;();</div><div class="line">    pinger-&gt;set_ponger_addr(ponger-&gt;get_address());</div><div class="line">    ponger-&gt;set_pinger_addr(pinger-&gt;get_address());</div><div class="line"></div><div class="line">    sup-&gt;do_process();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Without loss of generality the system context/supervisor can be switched to any other and the example will still work, because the actors in the sample are <b>loop-agnostic</b>, as well as the messages.</p>
<p>In the real world scenarios, actors might be not so pure, i.e. they will interact with timers and other system events, however the interface for sending messages is still the same (i.e. loop-agnostic), which makes it quite a convenient way to send messages to actors running on <em>diffent loops</em>.</p>
<h2>pub-sub example</h2>
<p>Any message can be send to any address; any actor, including actors running on different supervisors and loops, can subscribe to any kind of message on any address.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;rotor.hpp&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>r = rotor;</div><div class="line"></div><div class="line"><span class="keyword">struct </span>payload_t {};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>pub_t : <span class="keyword">public</span> r::actor_base_t {</div><div class="line"></div><div class="line">    <span class="keyword">using</span> r::actor_base_t::actor_base_t;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_pub_addr(<span class="keyword">const</span> r::address_ptr_t &amp;addr) { pub_addr = addr; }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_start(r::message_t&lt;r::payload::start_actor_t&gt; &amp;msg) noexcept <span class="keyword">override</span> {</div><div class="line">        r::actor_base_t::on_start(msg);</div><div class="line">        send&lt;payload_t&gt;(pub_addr);</div><div class="line">    }</div><div class="line"></div><div class="line">    r::address_ptr_t pub_addr;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>sub_t : <span class="keyword">public</span> r::actor_base_t {</div><div class="line">    <span class="keyword">using</span> r::actor_base_t::actor_base_t;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> set_pub_addr(<span class="keyword">const</span> r::address_ptr_t &amp;addr) { pub_addr = addr; }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_initialize(r::message_t&lt;r::payload::initialize_actor_t&gt; &amp;msg) noexcept <span class="keyword">override</span> {</div><div class="line">        r::actor_base_t::on_initialize(msg);</div><div class="line">        subscribe(&amp;sub_t::on_payload, pub_addr);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> on_payload(r::message_t&lt;payload_t&gt; &amp;) noexcept {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;received on &quot;</span> &lt;&lt; static_cast&lt;void *&gt;(<span class="keyword">this</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    r::address_ptr_t pub_addr;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>dummy_supervisor : <span class="keyword">public</span> <a class="code" href="structrotor_1_1supervisor__t.html">rotor::supervisor_t</a> {</div><div class="line">    <span class="keywordtype">void</span> start_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> cancel_shutdown_timer() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> start() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> shutdown() noexcept<span class="keyword"> override </span>{}</div><div class="line">    <span class="keywordtype">void</span> enqueue(rotor::message_ptr_t) noexcept <span class="keyword">override</span> {}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    <a class="code" href="structrotor_1_1system__context__t.html">rotor::system_context_t</a> ctx{};</div><div class="line">    <span class="keyword">auto</span> sup = ctx.create_supervisor&lt;dummy_supervisor&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> pub_addr = sup-&gt;create_address(); <span class="comment">// (1)</span></div><div class="line">    <span class="keyword">auto</span> pub = sup-&gt;create_actor&lt;pub_t&gt;();</div><div class="line">    <span class="keyword">auto</span> sub1 = sup-&gt;create_actor&lt;sub_t&gt;();</div><div class="line">    <span class="keyword">auto</span> sub2 = sup-&gt;create_actor&lt;sub_t&gt;();</div><div class="line"></div><div class="line">    pub-&gt;set_pub_addr(pub_addr);</div><div class="line">    sub1-&gt;set_pub_addr(pub_addr);</div><div class="line">    sub2-&gt;set_pub_addr(pub_addr);</div><div class="line"></div><div class="line">    sup-&gt;do_process();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Output sample: </p><div class="fragment"><div class="line">received on 0x55d159ea36c0</div><div class="line">received on 0x55d159ea3dc0</div></div><!-- fragment --><p>The address in the line <code>(1)</code> is arbitrary: the address of pub-actor itself as well as the address of the supervisor can be used... even address of different supervisor can be used. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
